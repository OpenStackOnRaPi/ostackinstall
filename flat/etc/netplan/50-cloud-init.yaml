# This file is generated from information provided by the datasource. Changes
# to it will not persist across an instance reboot.  In ubuntu, to disable
# cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
# in debian, this is not needed.
#=========================================#
# Network configs for the OpenStack lab   #
#=========================================#

network:
  version: 2
  renderer: networkd

#-----------------------------------------#
# WiFi configurations (optional)          #
# (uncomment if needed)                   #
#-----------------------------------------#
# WiFi can be hepful during configurations when we will teporarily loose connectivity to
# RPis from the fixed (cable) network used by OpenStack). RPis (but not OpenStack) will
# then be accessible via WiFi.
# WiFi should be configured as isolated subnetwork - distinct form the fixed (cable)
# network used to access OpenStack (provider external network/management network).
# E.g., on Linksys, you should dedicate a separate bridge (e.g., br1) to WiFi with
# distinct IP address range for this subnetwork. You will also have to enable routing
# between WiFi subnetwork and the fixed subnetwork used to access OpenStack.

## wlan0 itf will receive IP address from your router DHCP (linksys or TOTOLink in our case).
#  adjust access point SSID and password according to your environment
#  wifis:
#    wlan0:
#      access-points:
#        "accesspointSSID":
#          password: "accesspoitpassword"
#      dhcp4: true
#      optional: true

#-----------------------------------------#
# Kolla-Ansible networking configurations #
#-----------------------------------------#

# Interfaces

  ethernets:
    eth0:
      dhcp4: false
      dhcp6: false

# In the following, only veth0 and veth1 are necessary. The rest is incorrect when using systemd-networkd.
# It has been left for educational/comparative purposes. However, if only flat network were to be used in
# our OpenStack then one could uncomment the below definitions and not use systemd-networkd files at all.
#
# EXPLANATION: We must use systemd-networkd for persistent network constructs because some settings we need
# to set VLANs for provider networks are not possible to declare in netplan (at least at the time of this
# writing). At the same time, the rule for using netplan and systemd-networkd simultaneously is that a
# definition of a given network related construct must not appear in both the netplan file and the networkd file.
#
# For example, uncommenting the bridge "brmux" with interfaces "veth0br" and "veth1br" will result in
# incorrect VLAN configuration for those interfaces (they will be completely ignored) - see also the
# files in the /etc/systemd/network/ directory. In contrast, the DHCP declaration for eth0, and the
# addressing/DNS and IP routing settings for veth0 are correct, because they supplement the
# definitions of eth0 and veth0 with new elements (addressing and routing) - these elements
# are not present in the definitions provided in the /etc/systemd/network/ directory.
#
# NOTE: If netplan ever allows defining tagged VLANs for bridge interfaces, using systemd-networkd
# files will no longer be necessary, and all the configurations we need can be defined in the current file.

    # veth0-veth0br pair
    veth0:                  # network_interface for kolla-ansible
      addresses:
        - 192.168.1.6x/24   # ADJUST THIS ADDRESS FOR EACH YOUR RPI !!!!!!!!
      nameservers:
        addresses:
          - 192.168.1.1     # ADJUST to match your Linksys dhcp server
          - 8.8.8.8
          - 8.8.2.2
      routes:
        - to: 0.0.0.0/0
          via: 192.168.1.1  # ADJUST to match your Linksys router
#    veth0br:
#      dhcp4: false
#      dhcp6: false

    # veth1-veth1br pair
    veth1:                  # neutron_external_interface for kolla-ansible
      dhcp4: false
      dhcp6: false
#    veth1br:
#      dhcp4: false
#      dhcp6: false

# Bridge brmux 
# logically, this is a switch belonging to the local network of the
# data centre provider network (normally, L2 segment of a physical network)

#  bridges:
#    brmux:
#      interfaces:
#        - eth0
#        - veth0br
#        - veth1br
